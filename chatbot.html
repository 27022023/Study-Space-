<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Nova â€“ Pastel Study Buddy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Full math.js bundle -->
<script src="https://cdn.jsdelivr.net/npm/mathjs@11/dist/math.js"></script>

<style>
  :root{
    --bg1:#e8d9ff;
    --bg2:#d7eaff;
    --nova-bubble:#d4c4ff;
    --user-bubble:#c9f2ff;
    --text-main:#1e1e2e;
  }
  body{
    margin:0;
    font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background:linear-gradient(135deg,var(--bg1),var(--bg2));
    color:var(--text-main);
    display:flex;
    flex-direction:column;
    height:100vh;
  }
  header{
    padding:10px 16px;
    background:rgba(255,255,255,0.7);
    backdrop-filter:blur(10px);
    border-bottom:1px solid rgba(0,0,0,0.05);
    display:flex;
    align-items:center;
    gap:10px;
  }
  .nova-avatar{
    width:36px;
    height:36px;
    border-radius:50%;
    background:radial-gradient(circle at 30% 30%, #a855f7, #6366f1);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:20px;
  }
  .title{
    font-weight:700;
    font-size:16px;
  }
  .subtitle{
    font-size:12px;
    color:#4b5563;
  }
  #chat{
    flex:1;
    padding:12px;
    overflow-y:auto;
  }
  .msg{
    max-width:80%;
    margin:6px 0;
    padding:8px 12px;
    border-radius:12px;
    font-size:14px;
    line-height:1.4;
    white-space:pre-wrap;
  }
  .nova{
    background:var(--nova-bubble);
    margin-right:auto;
    border-bottom-left-radius:4px;
  }
  .user{
    background:var(--user-bubble);
    margin-left:auto;
    border-bottom-right-radius:4px;
  }
  #inputBar{
    display:flex;
    padding:8px;
    background:rgba(255,255,255,0.7);
    backdrop-filter:blur(10px);
    border-top:1px solid rgba(0,0,0,0.05);
    gap:8px;
  }
  #userInput{
    flex:1;
    padding:8px;
    border-radius:8px;
    border:1px solid rgba(148,163,184,0.8);
    background:rgba(255,255,255,0.8);
    color:var(--text-main);
  }
  #sendBtn{
    padding:8px 14px;
    border-radius:8px;
    border:none;
    background:#a855f7;
    color:white;
    font-weight:600;
    cursor:pointer;
  }
  #sendBtn:hover{
    background:#8b5cf6;
  }
  .hint{
    font-size:11px;
    color:#6b7280;
    padding:0 14px 6px;
  }
</style>
</head>

<body>

<header>
  <div class="nova-avatar">ðŸ¤–</div>
  <div>
    <div class="title">Nova</div>
    <div class="subtitle">Pastel study buddy â€“ Maths â€¢ Physics â€¢ Chemistry</div>
  </div>
</header>

<div id="chat"></div>

<div class="hint">
  You can type: 2x+3=11 â€¢ x^2-5x+6=0 â€¢ solve([2x+3y=7,-x+4y=5],[x,y]) â€¢ 0.5*2*3^2 â€¢ 0.2*6.022e23
</div>

<div id="inputBar">
  <input id="userInput" placeholder="Ask Nova in math formâ€¦" />
  <button id="sendBtn">Send</button>
</div>

<script>
/* ---------------- CHAT FUNCTIONS ---------------- */

const chat = document.getElementById("chat");
const input = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");

function addMessage(text, sender){
  const msg = document.createElement("div");
  msg.className = "msg " + sender;
  msg.textContent = text;
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
}

/* ---------------- NOVA BRAIN ---------------- */

function prettyPrint(result){
  if(Array.isArray(result)) return JSON.stringify(result, null, 2);
  if(result && typeof result === "object" && result.entries)
    return JSON.stringify(result.toArray(), null, 2);
  if(typeof result === "object")
    return JSON.stringify(result, null, 2);
  return String(result);
}

// Try to detect a simple equation like "2x+3=11" and wrap it in solve(...)
function tryAutoSolveEquation(text){
  if(!text.includes("=")) return null;
  // very simple heuristic: look for a variable letter
  const matchVar = text.match(/[a-zA-Z]/);
  if(!matchVar) return null;
  const variable = matchVar[0];
  // build solve(...) call
  return `solve(${text}, ${variable})`;
}

function novaRespond(question){
  let q = question.trim();

  try{
    // 1) If user already uses solve/derivative/simplify, just evaluate
    if(/solve\(|derivative\(|simplify\(/.test(q)){
      const result = math.evaluate(q);
      addMessage(prettyPrint(result), "nova");
      return;
    }

    // 2) Try auto equation solving if it looks like "something = something"
    if(q.includes("=")){
      const auto = tryAutoSolveEquation(q);
      if(auto){
        const result = math.evaluate(auto);
        addMessage(prettyPrint(result), "nova");
        return;
      }
    }

    // 3) Otherwise, treat it as a numeric / expression / physics / chem formula
    const result = math.evaluate(q);
    addMessage(prettyPrint(result), "nova");
  } catch(err){
    addMessage(
      "I couldn't understand that.\nTry:\n" +
      "â€¢ 2x+3=11\n" +
      "â€¢ x^2-5x+6=0\n" +
      "â€¢ solve([2x+3y=7,-x+4y=5],[x,y])\n" +
      "â€¢ 0.5*2*3^2 (physics)\n" +
      "â€¢ 0.2*6.022e23 (chemistry)",
      "nova"
    );
  }
}

/* ---------------- SEND MESSAGE ---------------- */

function send(){
  const text = input.value.trim();
  if(!text) return;

  addMessage(text, "user");
  input.value = "";

  setTimeout(() => novaRespond(text), 200);
}

sendBtn.onclick = send;
input.addEventListener("keydown", e => {
  if(e.key === "Enter") send();
});

/* ---------------- WELCOME MESSAGE ---------------- */

addMessage(
  "Hi! I'm Nova ðŸ’œ\n" +
  "I can help with algebra, systems, physics formulas, and chemistry calculations.\n" +
  "You can just type:\n" +
  "  2x+3=11\n" +
  "  x^2-5x+6=0\n" +
  "  solve([2x+3y=7,-x+4y=5],[x,y])\n" +
  "  0.5*2*3^2\n" +
  "  0.2*6.022e23",
  "nova"
);
</script>

</body>
</html>
