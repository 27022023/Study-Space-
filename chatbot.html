<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nova ‚Äì Study Companion</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root{
    --bg1:#e8d9ff;
    --bg2:#d7eaff;
    --nova-bubble:#d4c4ff;
    --user-bubble:#c9f2ff;
    --text-main:#1e1e2e;
  }
  body{
    margin:0;
    font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background:linear-gradient(135deg,var(--bg1),var(--bg2));
    color:var(--text-main);
    display:flex;
    flex-direction:column;
    height:100vh;
  }
  header{
    padding:10px 16px;
    background:rgba(255,255,255,0.7);
    backdrop-filter:blur(10px);
    border-bottom:1px solid rgba(0,0,0,0.05);
    display:flex;
    align-items:center;
    gap:10px;
  }
  .nova-avatar{
    width:36px;
    height:36px;
    border-radius:50%;
    background:radial-gradient(circle at 30% 30%, #a855f7, #6366f1);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:20px;
  }
  .title{
    font-weight:700;
    font-size:16px;
  }
  .subtitle{
    font-size:12px;
    color:#4b5563;
  }
  #chat{
    flex:1;
    padding:12px;
    overflow-y:auto;
  }
  .msg{
    max-width:80%;
    margin:6px 0;
    padding:8px 12px;
    border-radius:12px;
    font-size:14px;
    line-height:1.4;
    white-space:pre-wrap;
  }
  .nova{
    background:var(--nova-bubble);
    margin-right:auto;
    border-bottom-left-radius:4px;
  }
  .user{
    background:var(--user-bubble);
    margin-left:auto;
    border-bottom-right-radius:4px;
  }
  #inputBar{
    display:flex;
    padding:8px;
    background:rgba(255,255,255,0.7);
    backdrop-filter:blur(10px);
    border-top:1px solid rgba(0,0,0,0.05);
    gap:8px;
  }
  #userInput{
    flex:1;
    padding:8px;
    border-radius:8px;
    border:1px solid rgba(148,163,184,0.8);
    background:rgba(255,255,255,0.8);
    color:var(--text-main);
  }
  #sendBtn{
    padding:8px 14px;
    border-radius:8px;
    border:none;
    background:#a855f7;
    color:white;
    font-weight:600;
    cursor:pointer;
  }
  #sendBtn:hover{
    background:#8b5cf6;
  }
  .hint{
    font-size:11px;
    color:#6b7280;
    padding:0 14px 6px;
  }
</style>
</head>
<body>
/*  
   ‚≠ê NOVA UPGRADED BRAIN  
   ‚Äî Quadratics (with complex roots)  
   ‚Äî Systems of equations  
   ‚Äî Biology examples  
   ‚Äî Expanded physics & chemistry  
   ‚Äî Auto-detection  
   ‚Äî Same personality, same UI  
*/

const chatEl = document.getElementById("chat");
const inputEl = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");

let userName = null;
let mode = "math-first";
let lastMathProblem = null;

/* ---------------- EXAMPLE BANKS ---------------- */
const examples = {
  math: [
    { q:"Solve the equation: 2x - 5 = 11", a:"2x - 5 = 11 ‚áí 2x = 16 ‚áí x = 8." },
    { q:"Solve the system:\n2x + y = 7\nx - y = 1", a:"From x - y = 1 ‚áí y = x - 1.\nSubstitute: 2x + (x - 1) = 7 ‚áí 3x - 1 = 7 ‚áí 3x = 8 ‚áí x = 8/3, y = 5/3." },
    { q:"Solve the quadratic: x¬≤ - 5x + 6 = 0", a:"x¬≤ - 5x + 6 = 0 ‚áí (x - 2)(x - 3) = 0 ‚áí x = 2 or x = 3." },
    { q:"Find the derivative of f(x) = x¬≥ - 5x + 2", a:"f'(x) = 3x¬≤ - 5." },
    { q:"Compute the integral ‚à´(3x¬≤ - 4x + 1) dx", a:"x¬≥ - 2x¬≤ + x + C." },
    { q:"Find the domain of f(x) = 1/(x - 3)", a:"All real numbers except x = 3." },
    { q:"Probability: A coin is tossed 3 times. P(exactly 2 heads)?", a:"3/8." }
  ],
  physics: [
    { q:"A body moves with v = 10 m/s for 8 s. Distance?", a:"80 m." },
    { q:"Car accelerates from rest at 2 m/s¬≤ for 6 s. Final velocity?", a:"12 m/s." },
    { q:"Stone thrown up at 20 m/s. Max height?", a:"20 m." },
    { q:"R = 10 Œ©, V = 5 V. Current?", a:"0.5 A." },
    { q:"Wave f = 50 Hz, Œª = 2 m. Speed?", a:"100 m/s." },
    { q:"Mass 3 kg at 4 m/s. KE?", a:"24 J." },
    { q:"Force 10 N on 2 kg block. Acceleration?", a:"5 m/s¬≤." }
  ],
  chemistry: [
    { q:"Moles in 18 g water?", a:"1 mol." },
    { q:"Molarity of 5 g NaCl in 500 mL?", a:"‚âà0.17 M." },
    { q:"pH of 0.01 M HCl?", a:"2." },
    { q:"NH‚ÇÉ + H‚ÇÇO ‚Üí NH‚ÇÑ‚Å∫ + OH‚Åª: acid/base?", a:"NH‚ÇÉ base, H‚ÇÇO acid." },
    { q:"Mass percent: 10 g in 200 g?", a:"5%." },
    { q:"Balance H‚ÇÇ + O‚ÇÇ ‚Üí H‚ÇÇO", a:"2H‚ÇÇ + O‚ÇÇ ‚Üí 2H‚ÇÇO." },
    { q:"Gas 10 L at 300 K ‚Üí 600 K. New volume?", a:"20 L." }
  ],
  biology: [
    { q:"Function of mitochondria?", a:"ATP production." },
    { q:"What is DNA?", a:"Genetic information molecule." },
    { q:"Define osmosis.", a:"Water diffusion across membrane." },
    { q:"What is a gene?", a:"DNA segment coding for a trait." },
    { q:"Define homeostasis.", a:"Maintaining stable internal conditions." }
  ]
};

/* ---------------- UI HELPER ---------------- */
function addMessage(text, from="nova"){
  const div = document.createElement("div");
  div.className = "msg " + (from === "user" ? "user" : "nova");
  div.textContent = text;
  chatEl.appendChild(div);
  chatEl.scrollTop = chatEl.scrollHeight;
}

/* ---------------- DETECTION HELPERS ---------------- */
function looksLikeEquation(msg){
  return msg.includes("=") && /[0-9xy]/i.test(msg);
}

function looksLikeQuadratic(msg){
  const s = msg.replace(/\s+/g,"").toLowerCase();
  return looksLikeEquation(msg) && (s.includes("x^2") || s.includes("x¬≤"));
}

function looksLikeSystem(msg){
  const eqCount = (msg.match(/=/g) || []).length;
  return eqCount >= 2 || msg.includes("\n") || (msg.includes(",") && msg.includes("="));
}

function looksLikeArithmetic(msg){
  return /^[0-9+\-*/().\s]+$/.test(msg);
}

/* ---------------- SOLVERS ---------------- */
function safeEval(expr){
  try{
    if (!/^[0-9+\-*/().\s]+$/.test(expr)) return null;
    return Function("return ("+expr+")")();
  }catch{ return null; }
}

function solveLinearEquation(eqn){
  let s = eqn.replace(/\s+/g,"");
  const parts = s.split("=");
  if (parts.length !== 2) return null;

  const left = parts[0];
  const right = parts[1];

  const match = left.match(/([+-]?\d*)x([+-]\d+)?/i);
  if (!match) return null;

  let aStr = match[1];
  let bStr = match[2] || "+0";

  if (aStr === "" || aStr === "+") aStr = "1";
  if (aStr === "-") aStr = "-1";

  const a = parseFloat(aStr);
  const b = parseFloat(bStr);
  const c = parseFloat(right);

  if (isNaN(a) || isNaN(b) || isNaN(c) || a === 0) return null;

  return {a,b,c,x:(c-b)/a};
}

function solveQuadraticEquation(eqn){
  let s = eqn.replace(/\s+/g,"").toLowerCase().replace(/x¬≤/g,"x^2");
  const parts = s.split("=");
  if (parts.length !== 2) return null;

  let left = parts[0];
  let right = parts[1];

  if (right !== "0"){
    if (!/^[+\-]?\d+(\.\d+)?$/.test(right)) return null;
    const num = parseFloat(right);
    left += (num >= 0 ? `-${num}` : `+${-num}`);
  }

  const aMatch = left.match(/([+-]?\d*\.?\d*)x\^2/);
  if (!aMatch) return null;

  let aStr = aMatch[1];
  if (aStr === "" || aStr === "+") aStr = "1";
  if (aStr === "-") aStr = "-1";
  const a = parseFloat(aStr);

  let b = 0;
  const bMatch = left.match(/([+-]\d*\.?\d*)x(?!\^2)/);
  if (bMatch){
    let bStr = bMatch[1];
    if (bStr === "+" || bStr === "") bStr = "1";
    if (bStr === "-") bStr = "-1";
    b = parseFloat(bStr);
  }

  let c = 0;
  const constMatch = left
    .replace(/([+-]?\d*\.?\d*)x\^2/,"")
    .replace(/([+-]?\d*\.?\d*)x(?!\^2)/,"")
    .match(/[+-]?\d+(\.\d+)?/g);

  if (constMatch) c = constMatch.map(parseFloat).reduce((a,v)=>a+v,0);

  const D = b*b - 4*a*c;

  if (D > 0){
    const sqrtD = Math.sqrt(D);
    return {type:"real-distinct",a,b,c,D,x1:(-b+sqrtD)/(2*a),x2:(-b-sqrtD)/(2*a)};
  }
  if (D === 0){
    return {type:"real-double",a,b,c,D,x:(-b)/(2*a)};
  }

  const sqrtD = Math.sqrt(-D);
  return {
    type:"complex",
    a,b,c,D,
    real:(-b)/(2*a),
    imag:sqrtD/(2*a)
  };
}

function solveSystem2x2(text){
  let parts = text.split(/\n|,/).map(p=>p.trim()).filter(p=>p);
  if (parts.length !== 2) return null;

  function parseEq(e){
    const s = e.replace(/\s+/g,"");
    const sides = s.split("=");
    if (sides.length !== 2) return null;

    const left = sides[0];
    const right = parseFloat(sides[1]);

    const xMatch = left.match(/([+-]?\d*\.?\d*)x/);
    const yMatch = left.match(/([+-]?\d*\.?\d*)y/);

    let ax = 0, by = 0;

    if (xMatch){
      let xs = xMatch[1];
      if (xs === "" || xs === "+") xs = "1";
      if (xs === "-") xs = "-1";
      ax = parseFloat(xs);
    }
    if (yMatch){
      let ys = yMatch[1];
      if (ys === "" || ys === "+") ys = "1";
      if (ys === "-") ys = "-1";
      by = parseFloat(ys);
    }

    if (isNaN(right)) return null;
    return {ax,by,c:right};
  }

  const e1 = parseEq(parts[0]);
  const e2 = parseEq(parts[1]);
  if (!e1 || !e2) return null;

  const {ax:a1,by:b1,c:c1} = e1;
  const {ax:a2,by:b2,c:c2} = e2;

  const det = a1*b2 - a2*b1;

  if (det === 0){
    if (a1*c2 === a2*c1 && b1*c2 === b2*c1) return {type:"infinite"};
    return {type:"none"};
  }

  return {
    type:"unique",
    a1,b1,c1,a2,b2,c2,det,
    x:(c1*b2 - c2*b1)/det,
    y:(a1*c2 - a2*c1)/det
  };
}

/* ---------------- EXAMPLE PICKER ---------------- */
function getRandomExample(subject){
  const arr = examples[subject];
  return arr[Math.floor(Math.random()*arr.length)];
}
  
<header>
  <div class="nova-avatar">ü§ñ</div>
  <div>
    <div class="title">Nova</div>
    <div class="subtitle">Pastel study buddy ‚Äì Maths ‚Ä¢ Physics ‚Ä¢ Chemistry ‚Ä¢ Biology</div>
  </div>
</header>

<div class="hint">
  Try things like: ‚Äú2x - 5 = 11‚Äù, ‚Äúexample physics‚Äù, ‚Äúexample chemistry‚Äù, ‚Äúsolve 3x+2=11‚Äù, ‚Äúgive me a math example‚Äù.
</div>

<div id="chat"></div>

<div id="inputBar">
  <input id="userInput" type="text" placeholder="Give Nova a problem or ask for an example..." autocomplete="off">
  <button id="sendBtn">Send</button>
</div>

<script>
  <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nova ‚Äì Study Companion</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root{
    --bg1:#e8d9ff;
    --bg2:#d7eaff;
    --nova-bubble:#d4c4ff;
    --user-bubble:#c9f2ff;
    --text-main:#1e1e2e;
  }
  body{
    margin:0;
    font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background:linear-gradient(135deg,var(--bg1),var(--bg2));
    color:var(--text-main);
    display:flex;
    flex-direction:column;
    height:100vh;
  }
  header{
    padding:10px 16px;
    background:rgba(255,255,255,0.7);
    backdrop-filter:blur(10px);
    border-bottom:1px solid rgba(0,0,0,0.05);
    display:flex;
    align-items:center;
    gap:10px;
  }
  .nova-avatar{
    width:36px;
    height:36px;
    border-radius:50%;
    background:radial-gradient(circle at 30% 30%, #a855f7, #6366f1);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:20px;
  }
  .title{
    font-weight:700;
    font-size:16px;
  }
  .subtitle{
    font-size:12px;
    color:#4b5563;
  }
  #chat{
    flex:1;
    padding:12px;
    overflow-y:auto;
  }
  .msg{
    max-width:80%;
    margin:6px 0;
    padding:8px 12px;
    border-radius:12px;
    font-size:14px;
    line-height:1.4;
    white-space:pre-wrap;
  }
  .nova{
    background:var(--nova-bubble);
    margin-right:auto;
    border-bottom-left-radius:4px;
  }
  .user{
    background:var(--user-bubble);
    margin-left:auto;
    border-bottom-right-radius:4px;
  }
  #inputBar{
    display:flex;
    padding:8px;
    background:rgba(255,255,255,0.7);
    backdrop-filter:blur(10px);
    border-top:1px solid rgba(0,0,0,0.05);
    gap:8px;
  }
  #userInput{
    flex:1;
    padding:8px;
    border-radius:8px;
    border:1px solid rgba(148,163,184,0.8);
    background:rgba(255,255,255,0.8);
    color:var(--text-main);
  }
  #sendBtn{
    padding:8px 14px;
    border-radius:8px;
    border:none;
    background:#a855f7;
    color:white;
    font-weight:600;
    cursor:pointer;
  }
  #sendBtn:hover{
    background:#8b5cf6;
  }
  .hint{
    font-size:11px;
    color:#6b7280;
    padding:0 14px 6px;
  }
</style>
</head>
<body>

<header>
  <div class="nova-avatar">ü§ñ</div>
  <div>
    <div class="title">Nova</div>
    <div class="subtitle">Pastel study buddy ‚Äì Maths ‚Ä¢ Physics ‚Ä¢ Chemistry</div>
  </div>
</header>

<div class="hint">
  Try things like: ‚Äú2x - 5 = 11‚Äù, ‚Äúexample physics‚Äù, ‚Äúexample chemistry‚Äù, ‚Äúsolve 3x+2=11‚Äù, ‚Äúgive me a math example‚Äù.
</div>

<div id="chat"></div>

<div id="inputBar">
  <input id="userInput" type="text" placeholder="Give Nova a problem or ask for an example..." autocomplete="off">
  <button id="sendBtn">Send</button>
</div>

<script>
const chatEl = document.getElementById("chat");
const inputEl = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");

let userName = null;
let mode = "math-first"; // main focus
let lastMathProblem = null;

// --- Example banks (Maths / Physics / Chemistry) ---
const examples = {
  math: [
    {
      q:"Solve the equation: 2x - 5 = 11",
      a:"2x - 5 = 11 ‚áí 2x = 16 ‚áí x = 8."
    },
    {
      q:"Solve the system:\n2x + y = 7\nx - y = 1",
      a:"From x - y = 1 ‚áí y = x - 1.\nSubstitute: 2x + (x - 1) = 7 ‚áí 3x - 1 = 7 ‚áí 3x = 8 ‚áí x = 8/3, y = 5/3."
    },
    {
      q:"Solve the quadratic: x¬≤ - 5x + 6 = 0",
      a:"x¬≤ - 5x + 6 = 0 ‚áí (x - 2)(x - 3) = 0 ‚áí x = 2 or x = 3."
    },
    {
      q:"Find the derivative of f(x) = x¬≥ - 5x + 2",
      a:"f'(x) = 3x¬≤ - 5."
    },
    {
      q:"Compute the integral ‚à´(3x¬≤ - 4x + 1) dx",
      a:"‚à´3x¬≤ dx = x¬≥, ‚à´-4x dx = -2x¬≤, ‚à´1 dx = x ‚áí x¬≥ - 2x¬≤ + x + C."
    },
    {
      q:"Find the domain of f(x) = 1/(x - 3)",
      a:"All real numbers except x = 3."
    },
    {
      q:"Probability: A coin is tossed 3 times. P(exactly 2 heads)?",
      a:"Number of outcomes: 2¬≥ = 8. Ways to get 2 heads: 3. So P = 3/8."
    }
  ],
  physics: [
    {
      q:"A body moves with constant velocity v = 10 m/s. Find the distance in 8 s.",
      a:"s = v¬∑t = 10¬∑8 = 80 m."
    },
    {
      q:"A car accelerates from rest with a = 2 m/s¬≤. Find its velocity after 6 s.",
      a:"v = v‚ÇÄ + a¬∑t = 0 + 2¬∑6 = 12 m/s."
    },
    {
      q:"A stone is thrown upwards with v‚ÇÄ = 20 m/s. Approximate max height (g ‚âà 10 m/s¬≤).",
      a:"At top: v¬≤ = v‚ÇÄ¬≤ - 2gh ‚áí 0 = 400 - 20h ‚áí h = 20 m."
    },
    {
      q:"A resistor R = 10 Œ© is connected to V = 5 V. Find the current.",
      a:"Ohm‚Äôs law: I = V/R = 5/10 = 0.5 A."
    },
    {
      q:"A wave has frequency f = 50 Hz and wavelength Œª = 2 m. Find speed.",
      a:"v = f¬∑Œª = 50¬∑2 = 100 m/s."
    },
    {
      q:"A 3 kg mass moves at 4 m/s. Find kinetic energy.",
      a:"K = ¬Ωmv¬≤ = 0.5¬∑3¬∑16 = 24 J."
    }
  ],
  chemistry: [
    {
      q:"How many moles are in 18 g of water (H‚ÇÇO, M = 18 g/mol)?",
      a:"n = m/M = 18/18 = 1 mol."
    },
    {
      q:"Find the molarity of a solution with 5 g NaCl (M ‚âà 58.5 g/mol) in 500 mL.",
      a:"n = 5/58.5 ‚âà 0.0855 mol. Volume = 0.5 L ‚áí M ‚âà 0.17 mol/L."
    },
    {
      q:"pH of 0.01 M HCl (strong acid).",
      a:"[H‚Å∫] = 0.01 ‚áí pH = -log(0.01) = 2."
    },
    {
      q:"Identify acid/base in: NH‚ÇÉ + H‚ÇÇO ‚Üí NH‚ÇÑ‚Å∫ + OH‚Åª",
      a:"NH‚ÇÉ is a base (accepts H‚Å∫), H‚ÇÇO acts as an acid (donates H‚Å∫)."
    },
    {
      q:"Mass percent: 10 g solute in 200 g solution.",
      a:"% w/w = (10/200)¬∑100% = 5%."
    },
    {
      q:"Balance: H‚ÇÇ + O‚ÇÇ ‚Üí H‚ÇÇO",
      a:"Balanced: 2H‚ÇÇ + O‚ÇÇ ‚Üí 2H‚ÇÇO."
    }
  ]
};

// --- UI helpers ---
function addMessage(text, from="nova"){
  const div = document.createElement("div");
  div.className = "msg " + (from === "user" ? "user" : "nova");
  div.textContent = text;
  chatEl.appendChild(div);
  chatEl.scrollTop = chatEl.scrollHeight;
}

// --- Math detection helpers ---
function looksLikeEquation(msg){
  return msg.includes("=") && /[0-9x]/i.test(msg);
}

function solveLinearEquation(eqn){
  // very simple: ax + b = c
  // normalize: remove spaces
  let s = eqn.replace(/\s+/g,"");
  const parts = s.split("=");
  if (parts.length !== 2) return null;
  const left = parts[0];
  const right = parts[1];

  // move everything to left: left - right = 0
  // we only handle form ax + b = c
  // try to extract a and b from left, c from right
  // assume left like "ax+b" or "ax-b"
  const match = left.match(/([+-]?\d*)x([+-]\d+)?/i);
  if (!match) return null;

  let aStr = match[1];
  let bStr = match[2] || "+0";

  if (aStr === "" || aStr === "+") aStr = "1";
  if (aStr === "-") aStr = "-1";

  const a = parseFloat(aStr);
  const b = parseFloat(bStr);
  const c = parseFloat(right);

  if (isNaN(a) || isNaN(b) || isNaN(c) || a === 0) return null;

  const x = (c - b)/a;
  return {a,b,c,x};
}

function looksLikeArithmetic(msg){
  return /^[0-9+\-*/().\s]+$/.test(msg);
}

function safeEval(expr){
  try{
    // very basic safe eval: only numbers and operators
    if (!/^[0-9+\-*/().\s]+$/.test(expr)) return null;
    // eslint-disable-next-line no-new-func
    const f = new Function("return ("+expr+")");
    return f();
  }catch{
    return null;
  }
}

// --- Example selection ---
function getRandomExample(subject){
  const arr = examples[subject];
  if (!arr || arr.length === 0) return null;
  return arr[Math.floor(Math.random()*arr.length)];
}

// --- Nova brain ---
function novaRespond(raw){
  const msg = raw.trim();
  const lower = msg.toLowerCase();

  if (!msg) return "Give me something to chew on ‚Äî a problem, an equation, anything.";

  // name detection
  if (!userName && (lower.startsWith("i am ") || lower.startsWith("i'm "))){
    userName = msg.split(" ").slice(2).join(" ") || "œÜŒØŒªŒµ";
    return `ŒßŒ¨œÅŒ∑Œ∫Œ±, ${userName}. I‚Äôm best at solving problems in maths, physics and chemistry. Try giving me one.`;
  }
  if (!userName && lower.includes("my name is")){
    userName = msg.split(/my name is/i)[1].trim() || "œÜŒØŒªŒµ";
    return `Nice to meet you, ${userName}. Throw me a problem when you‚Äôre ready.`;
  }

  // ask for examples
  if (lower.includes("example") || lower.includes("exercise") || lower.includes("askisi") || lower.includes("Œ¨œÉŒ∫Œ∑œÉŒ∑")){
    if (lower.includes("physics") || lower.includes("fysik") || lower.includes("œÜœÖœÉŒπŒ∫ŒÆ")){
      const ex = getRandomExample("physics");
      return ex ? `Physics example:\n\nQ: ${ex.q}\nA: ${ex.a}` : "I don‚Äôt have a physics example ready yet.";
    }
    if (lower.includes("chem") || lower.includes("œáŒ∑ŒºŒµŒØŒ±")){
      const ex = getRandomExample("chemistry");
      return ex ? `Chemistry example:\n\nQ: ${ex.q}\nA: ${ex.a}` : "I don‚Äôt have a chemistry example ready yet.";
    }
    // default to math
    const ex = getRandomExample("math");
    return ex ? `Math example:\n\nQ: ${ex.q}\nA: ${ex.a}` : "I don‚Äôt have a math example ready yet.";
  }

  // explicit subject requests
  if (lower.includes("math") || lower.includes("ŒºŒ±Œ∏Œ∑ŒºŒ±œÑŒπŒ∫Œ¨")){
    const ex = getRandomExample("math");
    return ex ? `Here‚Äôs a math example:\n\nQ: ${ex.q}\nA: ${ex.a}\n\nYou can also give me your own equation to solve.` 
              : "I‚Äôm ready for math, just give me an equation.";
  }
  if (lower.includes("physics") || lower.includes("œÜœÖœÉŒπŒ∫ŒÆ")){
    const ex = getRandomExample("physics");
    return ex ? `Here‚Äôs a physics example:\n\nQ: ${ex.q}\nA: ${ex.a}` 
              : "I‚Äôm ready for physics questions when you are.";
  }
  if (lower.includes("chemistry") || lower.includes("œáŒ∑ŒºŒµŒØŒ±")){
    const ex = getRandomExample("chemistry");
    return ex ? `Here‚Äôs a chemistry example:\n\nQ: ${ex.q}\nA: ${ex.a}` 
              : "I‚Äôm ready for chemistry questions when you are.";
  }

  // equation solving
  if (looksLikeEquation(msg)){
    const sol = solveLinearEquation(msg);
    if (sol){
      lastMathProblem = msg;
      return `Let‚Äôs solve: ${msg}\n\nWe have a = ${sol.a}, b = ${sol.b}, c = ${sol.c}.\nSo  ${sol.a}x + ${sol.b} = ${sol.c} ‚áí ${sol.a}x = ${sol.c - sol.b} ‚áí x = ${(sol.c - sol.b)}/${sol.a} = ${sol.x}.`;
    }else{
      return "That looks like an equation, but it‚Äôs a bit more complex than my simple linear solver. You can still ask me for examples in maths, physics or chemistry.";
    }
  }

  // arithmetic
  if (looksLikeArithmetic(msg)){
    const val = safeEval(msg);
    if (val !== null){
      lastMathProblem = msg;
      return `${msg} = ${val}`;
    }
  }

  // if user gives a number after a problem
  if (!isNaN(parseFloat(msg)) && lastMathProblem){
    return `If that number is your answer to ‚Äú${lastMathProblem}‚Äù, tell me the full equation so I can check it properly.`;
  }

  // emotional / general
  if (["sad","upset","tired","stressed","frustrated","Œ±Œ≥œáœâŒºŒ≠ŒΩŒøœÇ","Œ±Œ≥œáœâŒºŒµŒΩŒøœÇ","Œ∫ŒøœÖœÅŒ±œÉŒºŒ≠ŒΩŒøœÇ"].some(w => lower.includes(w))){
    return "Okay, pause. You‚Äôre allowed to feel like that. If you want, give me a problem and I‚Äôll handle the thinking part for a bit.";
  }

  // chat requests
  if (lower.includes("chat") || lower.includes("talk") || lower.includes("œÉœÖŒ∂ŒÆœÑŒ∑œÉŒ∑")){
    mode = "chat";
    return "We can chat a bit, but remember: my superpower is solving problems. Whenever you‚Äôre ready, just drop one in.";
  }

  // default: gently push back to problems
  if (mode === "math-first"){
    return "I love that you‚Äôre talking to me. Now give me something to solve ‚Äî maths, physics, chemistry, whatever you‚Äôre working on.";
  }else{
    return "I‚Äôm listening. And whenever you want, we can jump back into problems.";
  }
}

// --- Wiring UI ---
function handleSend(){
  const text = inputEl.value.trim();
  if (!text) return;
  addMessage(text,"user");
  inputEl.value = "";
  const reply = novaRespond(text);
  setTimeout(() => addMessage(reply,"nova"), 120);
}

sendBtn.addEventListener("click", handleSend);
inputEl.addEventListener("keydown", e => {
  if (e.key === "Enter") handleSend();
});

// greeting
addMessage("Hey, I‚Äôm Nova üíú.\nI‚Äôm built to help with maths, physics and chemistry ‚Äî especially higher levels.\nTry giving me an equation like ‚Äú2x - 5 = 11‚Äù or say ‚Äúexample physics‚Äù.","nova");
</script>

</body>
</html>
