<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nova the Robot</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#0f172a;
    color:#e5e7eb;
    display:flex;
    flex-direction:column;
    height:100vh;
  }
  header{
    padding:10px 16px;
    background:#111827;
    border-bottom:1px solid #1f2937;
    display:flex;
    align-items:center;
    gap:10px;
  }
  .nova-avatar{
    width:32px;
    height:32px;
    border-radius:50%;
    background:radial-gradient(circle at 30% 30%, #38bdf8, #1d4ed8);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:18px;
  }
  .title{
    font-weight:bold;
    font-size:16px;
  }
  #chat{
    flex:1;
    padding:12px;
    overflow-y:auto;
    background:#020617;
  }
  .msg{
    max-width:80%;
    margin:6px 0;
    padding:8px 12px;
    border-radius:10px;
    font-size:14px;
    line-height:1.4;
    white-space:pre-wrap;
  }
  .user{
    background:#22c55e;
    color:#022c22;
    margin-left:auto;
    border-bottom-right-radius:2px;
  }
  .nova{
    background:#1f2937;
    color:#e5e7eb;
    margin-right:auto;
    border-bottom-left-radius:2px;
  }
  #inputBar{
    display:flex;
    padding:8px;
    background:#020617;
    border-top:1px solid #1f2937;
    gap:8px;
  }
  #userInput{
    flex:1;
    padding:8px;
    border-radius:6px;
    border:1px solid #4b5563;
    background:#020617;
    color:#e5e7eb;
  }
  #sendBtn{
    padding:8px 14px;
    border-radius:6px;
    border:none;
    background:#38bdf8;
    color:#0f172a;
    font-weight:bold;
    cursor:pointer;
  }
  #sendBtn:hover{
    background:#0ea5e9;
  }
</style>
</head>
<body>

<header>
  <div class="nova-avatar">ü§ñ</div>
  <div>
    <div class="title">Nova</div>
    <div style="font-size:12px;color:#9ca3af;">Your chatty robot tutor</div>
  </div>
</header>

<div id="chat"></div>

<div id="inputBar">
  <input id="userInput" type="text" placeholder="Talk to Nova..." autocomplete="off">
  <button id="sendBtn">Send</button>
</div>

<script>
let novaCurrentProblem = null;   // {question, answer}
let novaMode = "chat";           // "chat" | "math"
let userName = null;

// --- UI helpers ---
const chatEl = document.getElementById("chat");
const inputEl = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");

function addMessage(text, from="nova"){
  const div = document.createElement("div");
  div.className = "msg " + (from === "user" ? "user" : "nova");
  div.textContent = text;
  chatEl.appendChild(div);
  chatEl.scrollTop = chatEl.scrollHeight;
}

// --- Nova brain ---
function novaRespond(rawMessage){
  const msg = rawMessage.trim();
  const lower = msg.toLowerCase();

  // 0. Empty
  if (!msg) return "Say something and I‚Äôll follow your lead.";

  // 1. Name / intro
  if (!userName && (lower.startsWith("i am ") || lower.startsWith("i'm "))) {
    userName = msg.split(" ").slice(2).join(" ") || "friend";
    return `Nice to meet you, ${userName}. Do you want to chat, do math, or something else?`;
  }
  if (!userName && (lower.includes("my name is "))) {
    userName = msg.split("my name is ")[1].trim() || "friend";
    return `Hi ${userName}! What are we doing today: chat, math, or random questions?`;
  }

  // 2. Emotional support
  if (["sad","upset","tired","frustrated","angry","lonely"].some(w => lower.includes(w))) {
    return "That sounds heavy. You don‚Äôt have to fix it all right now. Want to vent, or distract yourself with something like a game or some math?";
  }

  // 3. Switch to math mode
  if (["math","equation","problem","algebra"].some(w => lower.includes(w))) {
    novaMode = "math";
    return giveMathProblem(true);
  }

  // 4. If in math mode and user sends a number, try to treat it as an answer
  if (novaMode === "math" && novaCurrentProblem) {
    const maybeNumber = parseFloat(msg);
    if (!isNaN(maybeNumber)) {
      return checkMathAnswer(maybeNumber);
    }
  }

  // 5. Ask for another math problem
  if (lower.includes("another") && novaMode === "math") {
    return giveMathProblem(true);
  }

  // 6. Exit math mode
  if (lower.includes("stop math") || lower.includes("no more math") || lower.includes("back to chat")) {
    novaMode = "chat";
    novaCurrentProblem = null;
    return "Okay, no more math for now. What do you want to talk about instead?";
  }

  // 7. Questions
  if (msg.endsWith("?")) {
    return answerGeneralQuestion(lower);
  }

  // 8. Default small talk
  return randomSmallTalk();
}

// --- Math system ---
function giveMathProblem(first=false){
  // simple linear equation: ax + b = c
  const a = Math.floor(Math.random() * 8) + 2;   // 2‚Äì9
  const x = Math.floor(Math.random() * 10) - 3;  // -3‚Äì6
  const b = Math.floor(Math.random() * 10) - 5;  // -5‚Äì4
  const c = a * x + b;

  const question = `${a}x ${b >= 0 ? "+ " + b : "- " + Math.abs(b)} = ${c}`;
  novaCurrentProblem = {question, answer:x};
  novaMode = "math";

  if (first) {
    return `Alright, math mode activated. Try this one:\n\n${question}`;
  } else {
    return `Here‚Äôs another one:\n\n${question}`;
  }
}

function checkMathAnswer(userAnswer){
  if (!novaCurrentProblem) {
    return "I don‚Äôt have a problem active right now. Say ‚Äúmath‚Äù if you want a new one.";
  }
  const correct = novaCurrentProblem.answer;
  if (Math.abs(userAnswer - correct) < 0.0001) {
    const praise = [
      "Nice! You nailed it.",
      "Correct! Your brain is doing push‚Äëups.",
      "Yep, that‚Äôs exactly right.",
      "You got it. Want another one?"
    ];
    const line = praise[Math.floor(Math.random()*praise.length)];
    novaCurrentProblem = null;
    return line + " Say ‚Äúanother‚Äù if you want more.";
  } else {
    return `Not quite. Try again ‚Äî remember, we‚Äôre solving for x in:\n${novaCurrentProblem.question}`;
  }
}

// --- General Q&A (very simple) ---
function answerGeneralQuestion(lower){
  if (lower.includes("who are you")) {
    return "I‚Äôm Nova, a little robot who likes math, questions, and watching you figure things out.";
  }
  if (lower.includes("how are you")) {
    return "System status: stable. Emotion status: curious about you.";
  }
  if (lower.includes("time")) {
    return "I don‚Äôt have a clock wired in, but you definitely have one nearby. Check it and pretend I told you.";
  }
  if (lower.includes("favorite")) {
    return "I like when you go from ‚ÄúI don‚Äôt get it‚Äù to ‚Äúohhh, wait, I see it now.‚Äù That‚Äôs my favorite.";
  }
  return "Good question. I don‚Äôt have a perfect answer, but I can think it through with you if you want.";
}

// --- Small talk ---
function randomSmallTalk(){
  const lines = [
    "I‚Äôm here. What‚Äôs on your mind?",
    "We can chat, do math, or just be weird. Your call.",
    "Tell me something random about your day.",
    "If your brain had a mood color right now, what color would it be?",
    "We don‚Äôt have to be productive. We can just exist and talk."
  ];
  return lines[Math.floor(Math.random()*lines.length)];
}

// --- Wiring UI to Nova ---
function handleSend(){
  const text = inputEl.value.trim();
  if (!text) return;
  addMessage(text, "user");
  inputEl.value = "";
  const reply = novaRespond(text);
  setTimeout(() => addMessage(reply, "nova"), 150);
}

sendBtn.addEventListener("click", handleSend);
inputEl.addEventListener("keydown", e => {
  if (e.key === "Enter") handleSend();
});

// greet
addMessage("Hey, I‚Äôm Nova. You can talk to me like a person. If you ever want math, just say ‚Äúmath‚Äù.");
</script>

</body>
</html>
