<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Relax</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #ffe6f2; /* soft pastel pink */
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 480px;
      padding: 30px 20px 40px;
      box-sizing: border-box;
      text-align: center;
    }

    h1 {
      margin: 0 0 20px;
      color: #5a305a;
      font-size: 28px;
    }

    /* Timer section */
    .timer-section {
      margin-bottom: 25px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 16px;
      padding: 15px 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }

    .timer-label {
      font-size: 16px;
      color: #5a305a;
      margin-bottom: 10px;
    }

    .timer-controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    select {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #d1b3c8;
      font-size: 14px;
      background: #fff;
      color: #5a305a;
    }

    .timer-status {
      margin-top: 8px;
      font-size: 14px;
      color: #7a4b7a;
      min-height: 18px;
    }

    /* Breathing section */
    .breath-section {
      margin-bottom: 25px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      padding: 20px 20px 25px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .breath-box {
      font-size: 40px;
      padding: 30px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(6px);
      width: 220px;
      margin: 10px auto 10px;
      animation: fade 4s ease-in-out infinite;
    }

    @keyframes fade {
      0% { opacity: 0.4; transform: scale(0.96); }
      50% { opacity: 1; transform: scale(1.04); }
      100% { opacity: 0.4; transform: scale(0.96); }
    }

    .breath-text {
      font-size: 20px;
      margin-top: 8px;
      color: #5a4a6a;
    }

    .start-btn {
      margin-top: 15px;
      padding: 10px 22px;
      border-radius: 999px;
      border: none;
      background: #ff9ac2;
      color: #4a234a;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
      transition: background 0.2s, transform 0.1s;
    }

    .start-btn:hover {
      background: #ff7fb4;
      transform: translateY(-1px);
    }

    .start-btn:active {
      transform: translateY(1px);
      box-shadow: 0 1px 4px rgba(0,0,0,0.2);
    }

    /* Sounds section */
    .sounds-section {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 18px;
      padding: 18px 18px 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }

    .sounds-title {
      font-size: 18px;
      color: #5a305a;
      margin-bottom: 10px;
    }

    .sound-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    .sound-btn {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid #d1b3c8;
      background: #fff;
      color: #5a305a;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s, border-color 0.2s;
    }

    .sound-btn.active {
      background: #ffb3d6;
      color: #4a234a;
      border-color: #ff7fb4;
      box-shadow: 0 3px 8px rgba(0,0,0,0.12);
    }

    .note {
      margin-top: 10px;
      font-size: 12px;
      color: #7a4b7a;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="timer-section">
      <div class="timer-label">Choose how long you want to relax</div>
      <div class="timer-controls">
        <select id="durationSelect">
          <option value="1">1 minute</option>
          <option value="3">3 minutes</option>
          <option value="5" selected>5 minutes</option>
          <option value="10">10 minutes</option>
        </select>
      </div>
      <div class="timer-status" id="timerStatus"></div>
    </div>

    <div class="breath-section">
      <h1>Take a Moment</h1>
      <div class="breath-box" id="emojiBox">‚ò∫Ô∏è</div>
      <p class="breath-text" id="breathText">breathe in‚Ä¶</p>
      <button class="start-btn" id="startStopBtn">Start</button>
    </div>

    <div class="sounds-section">
      <div class="sounds-title">Sounds (toggle any combination)</div>
      <div class="sound-buttons">
        <button class="sound-btn" data-sound="rain">üåßÔ∏è Rain</button>
        <button class="sound-btn" data-sound="ocean">üåä Ocean</button>
        <button class="sound-btn" data-sound="wind">üçÉ Wind</button>
        <button class="sound-btn" data-sound="space">ü™ê Space</button>
      </div>
      <div class="note">Sounds will fade in when you press Start and fade out when you press Stop or when the timer ends.</div>
    </div>
  </div>

  <script>
    // --- Breathing logic ---
    const emojis = ["‚ò∫Ô∏è", "üíó", "ü™∑", "üåø", "üå∏", "üåô", "‚ú®", "ü´ß", "üåä", "üíû"];
    let emojiIndex = 0;
    let breathingIn = true;
    let breathingInterval = null;

    const emojiBox = document.getElementById("emojiBox");
    const breathText = document.getElementById("breathText");
    const startStopBtn = document.getElementById("startStopBtn");
    const durationSelect = document.getElementById("durationSelect");
    const timerStatus = document.getElementById("timerStatus");

    let sessionRunning = false;
    let timerTimeout = null;
    let remainingSecondsInterval = null;
    let sessionEndTime = null;

    function updateBreathing() {
      emojiIndex = (emojiIndex + 1) % emojis.length;
      emojiBox.innerText = emojis[emojiIndex];

      breathingIn = !breathingIn;
      breathText.innerText = breathingIn ? "breathe in‚Ä¶" : "breathe out‚Ä¶";
    }

    function startBreathing() {
      // reset state
      emojiIndex = 0;
      breathingIn = true;
      emojiBox.innerText = emojis[emojiIndex];
      breathText.innerText = "breathe in‚Ä¶";

      if (breathingInterval) clearInterval(breathingInterval);
      breathingInterval = setInterval(updateBreathing, 4000);
    }

    function stopBreathing() {
      if (breathingInterval) {
        clearInterval(breathingInterval);
        breathingInterval = null;
      }
    }

    // --- Timer logic ---
    function startTimer() {
      const minutes = parseInt(durationSelect.value, 10);
      const durationMs = minutes * 60 * 1000;
      const now = Date.now();
      sessionEndTime = now + durationMs;

      timerStatus.textContent = `Session: ${minutes} minute(s)`;
      if (timerTimeout) clearTimeout(timerTimeout);
      if (remainingSecondsInterval) clearInterval(remainingSecondsInterval);

      timerTimeout = setTimeout(() => {
        stopSession("Session complete");
      }, durationMs);

      remainingSecondsInterval = setInterval(() => {
        const remainingMs = sessionEndTime - Date.now();
        if (remainingMs <= 0) {
          clearInterval(remainingSecondsInterval);
          return;
        }
        const remainingSec = Math.round(remainingMs / 1000);
        timerStatus.textContent = `Time left: ${remainingSec} second(s)`;
      }, 1000);
    }

    function stopTimer(message) {
      if (timerTimeout) {
        clearTimeout(timerTimeout);
        timerTimeout = null;
      }
      if (remainingSecondsInterval) {
        clearInterval(remainingSecondsInterval);
        remainingSecondsInterval = null;
      }
      timerStatus.textContent = message || "";
    }

    // --- Sound logic with smooth fade ---
    const soundConfig = {
      rain: {
        src: "https://cdn.pixabay.com/download/audio/2021/08/04/audio_7b3c1f3f3a.mp3?filename=rain-ambient-6101.mp3"
      },
      ocean: {
        src: "https://cdn.pixabay.com/download/audio/2021/08/04/audio_3f6b9f96e5.mp3?filename=waves-ambient-6105.mp3"
      },
      wind: {
        src: "https://cdn.pixabay.com/download/audio/2021/08/04/audio_5f4f0a1d57.mp3?filename=wind-nature-6100.mp3"
      },
      space: {
        src: "https://cdn.pixabay.com/download/audio/2022/03/15/audio_4b0f5bd8a3.mp3?filename=ambient-space-110241.mp3"
      }
    };

    const sounds = {};
    const maxVolume = 0.6;
    const fadeStep = 0.05;
    const fadeIntervalMs = 120;
    let fadeInterval = null;

    function ensureSound(key) {
      if (!sounds[key]) {
        const audio = new Audio(soundConfig[key].src);
        audio.loop = true;
        audio.volume = 0;
        sounds[key] = {
          audio,
          targetVolume: 0,
          currentVolume: 0,
          selected: false
        };
      }
      return sounds[key];
    }

    function updateFadeLoop() {
      if (fadeInterval) return;
      fadeInterval = setInterval(() => {
        let anyActive = false;
        for (const key in sounds) {
          const s = sounds[key];
          if (!s) continue;
          if (Math.abs(s.currentVolume - s.targetVolume) > 0.01) {
            anyActive = true;
            if (s.currentVolume < s.targetVolume) {
              s.currentVolume = Math.min(s.currentVolume + fadeStep, s.targetVolume);
            } else {
              s.currentVolume = Math.max(s.currentVolume - fadeStep, s.targetVolume);
            }
            s.audio.volume = s.currentVolume;
            if (s.currentVolume > 0 && s.audio.paused) {
              s.audio.play().catch(() => {});
            }
            if (s.currentVolume === 0 && s.targetVolume === 0) {
              s.audio.pause();
            }
          }
        }
        if (!anyActive) {
          clearInterval(fadeInterval);
          fadeInterval = null;
        }
      }, fadeIntervalMs);
    }

    function setSoundActive(key, active) {
      const s = ensureSound(key);
      s.targetVolume = active ? maxVolume : 0;
      updateFadeLoop();
    }

    function applySelectedSoundsOnStart() {
      for (const key in sounds) {
        const s = sounds[key];
        if (!s) continue;
        if (s.selected) {
          s.targetVolume = maxVolume;
        } else {
          s.targetVolume = 0;
        }
      }
      updateFadeLoop();
    }

    function fadeOutAllSounds() {
      for (const key in sounds) {
        const s = sounds[key];
        if (!s) continue;
        s.targetVolume = 0;
      }
      updateFadeLoop();
    }

    // --- Sound buttons UI ---
    const soundButtons = document.querySelectorAll(".sound-btn");
    soundButtons.forEach(btn => {
      const key = btn.getAttribute("data-sound");
      ensureSound(key);
      btn.addEventListener("click", () => {
        const s = sounds[key];
        s.selected = !s.selected;
        btn.classList.toggle("active", s.selected);

        // If session is running, immediately fade in/out this sound
        if (sessionRunning) {
          setSoundActive(key, s.selected);
        }
      });
    });

    // --- Session control ---
    function startSession() {
      sessionRunning = true;
      startStopBtn.textContent = "Stop";
      startBreathing();
      startTimer();
      applySelectedSoundsOnStart();
    }

    function stopSession(message) {
      sessionRunning = false;
      startStopBtn.textContent = "Start";
      stopBreathing();
      stopTimer(message || "");
      fadeOutAllSounds();
    }

    startStopBtn.addEventListener("click", () => {
      if (!sessionRunning) {
        stopTimer(""); // clear any old message
        startSession();
      } else {
        stopSession("Stopped");
      }
    });
  </script>
</body>
</html>
