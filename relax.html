<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" href="icon_1772044007674.png?v=1" type="image/png">
<meta charset="UTF-8">
<title>Relax</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(180deg, #ffe6f2 0%, #f3e8ff 50%, #e3f2ff 100%);
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
  }

  .container {
    width: 100%;
    max-width: 480px;
    padding: 30px 20px 40px;
    box-sizing: border-box;
    text-align: center;
  }

  h1 {
    margin: 0 0 20px;
    color: #5a305a;
    font-size: 28px;
  }

  .section {
    background: rgba(243, 232, 255, 0.9);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 25px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }

  .breath-box {
    font-size: 40px;
    padding: 30px;
    border-radius: 20px;
    background: rgba(255, 255, 255, 0.9);
    width: 220px;
    margin: 10px auto;
    animation: fade 4s ease-in-out infinite;
  }

  @keyframes fade {
    0% { opacity: 0.4; transform: scale(0.96); }
    50% { opacity: 1; transform: scale(1.04); }
    100% { opacity: 0.4; transform: scale(0.96); }
  }

  .start-btn {
    margin-top: 15px;
    padding: 10px 22px;
    border-radius: 999px;
    border: none;
    background: #ff9ac2;
    color: #4a234a;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
  }

  .sound-btn {
    padding: 8px 14px;
    border-radius: 999px;
    border: 1px solid #d1b3c8;
    background: #fff;
    color: #5a305a;
    cursor: pointer;
    margin: 3px;
  }

  .sound-btn.active {
    background: #ffb3d6;
    border-color: #ff7fb4;
  }

  .volume-slider {
    width: 100%;
    margin-top: 15px;
  }

  input[type="number"] {
    padding: 6px;
    width: 80px;
    border-radius: 10px;
    border: 1px solid #c9b3d9;
    margin-top: 10px;
  }
</style>
</head>

<body>
<div class="container">

  <!-- TIMER AT THE TOP -->
  <div class="section">
    <h2 style="color:#5a305a;">Timer</h2>
    <p id="timerDisplay" style="font-size:22px;color:#5a305a;">00:00</p>

    <div style="margin-top:10px;">
      <button class="sound-btn" onclick="setTimer(1)">1 min</button>
      <button class="sound-btn" onclick="setTimer(3)">3 min</button>
      <button class="sound-btn" onclick="setTimer(5)">5 min</button>
      <button class="sound-btn" onclick="setTimer(10)">10 min</button>
    </div>

    <p style="margin-top:15px;color:#5a305a;">Custom minutes</p>
    <input type="number" id="customMinutes" min="1" placeholder="min">
    <button class="sound-btn" onclick="applyCustom()">Set</button>
  </div>

  <!-- BREATHING IN THE MIDDLE -->
  <div class="section">
    <h1>Take a Moment</h1>
    <div class="breath-box" id="emojiBox">‚ò∫Ô∏è</div>
    <p id="breathText">breathe in‚Ä¶</p>
    <button class="start-btn" id="startStopBtn">Start</button>
  </div>

  <!-- SOUNDS AT THE BOTTOM -->
  <div class="section">
    <h2 style="color:#5a305a;">Sounds</h2>
    <div>
      <button class="sound-btn" data-sound="rain">üåßÔ∏è Rain</button>
      <button class="sound-btn" data-sound="ocean">üåä Ocean</button>
      <button class="sound-btn" data-sound="wind">üçÉ Wind</button>
      <button class="sound-btn" data-sound="space">ü™ê Space</button>
    </div>

    <p style="margin-top:15px;color:#5a305a;">Volume</p>
    <input type="range" min="0" max="1" step="0.01" value="0.5"
           id="volumeSlider" class="volume-slider">
  </div>

</div>

<script>
/* ---------------- BREATHING ---------------- */
const emojis = ["‚ò∫Ô∏è","üíó","ü™∑","üåø","üå∏","üåô","‚ú®","ü´ß","üåä","üíû"];
let emojiIndex = 0;
let breathingIn = true;
let breathingInterval = null;

const emojiBox = document.getElementById("emojiBox");
const breathText = document.getElementById("breathText");
const startStopBtn = document.getElementById("startStopBtn");

function updateBreathing() {
  emojiIndex = (emojiIndex + 1) % emojis.length;
  emojiBox.innerText = emojis[emojiIndex];
  breathingIn = !breathingIn;
  breathText.innerText = breathingIn ? "breathe in‚Ä¶" : "breathe out‚Ä¶";
}

function startBreathing() {
  breathingInterval = setInterval(updateBreathing, 4000);
}

function stopBreathing() {
  clearInterval(breathingInterval);
}

/* ---------------- TIMER ---------------- */
let timerInterval = null;
let timeLeft = 0;

function setTimer(minutes) {
  timeLeft = minutes * 60;
  updateTimerDisplay();
}

function applyCustom() {
  const val = parseInt(document.getElementById("customMinutes").value);
  if (!isNaN(val) && val > 0) {
    setTimer(val);
  }
}

function updateTimerDisplay() {
  const mins = String(Math.floor(timeLeft / 60)).padStart(2, "0");
  const secs = String(timeLeft % 60).padStart(2, "0");
  document.getElementById("timerDisplay").textContent = `${mins}:${secs}`;
}

function startTimer() {
  if (timeLeft <= 0) return;

  timerInterval = setInterval(() => {
    timeLeft--;
    updateTimerDisplay();

    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      timerInterval = null;
      startStopBtn.click(); // stop session
    }
  }, 1000);
}

function stopTimer() {
  clearInterval(timerInterval);
  timerInterval = null;
}

/* ---------------- WEB AUDIO ---------------- */
let audioCtx = null;
let masterGain = null;

const soundNodes = {
  rain: null,
  ocean: null,
  wind: null,
  space: null
};

function createNoise(type="white") {
  const bufferSize = 2 * audioCtx.sampleRate;
  const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
  const data = buffer.getChannelData(0);

  let lastOut = 0;
  for (let i = 0; i < bufferSize; i++) {
    let white = Math.random() * 2 - 1;
    if (type === "white") {
      data[i] = white;
    } else if (type === "brown") {
      lastOut = (lastOut + (0.02 * white)) / 1.02;
      data[i] = lastOut * 3.5;
    }
  }

  const noise = audioCtx.createBufferSource();
  noise.buffer = buffer;
  noise.loop = true;
  return noise;
}

function startSound(key) {
  if (!audioCtx) return;
  if (soundNodes[key]) return;

  let node;

  if (key === "rain") node = createNoise("white");
  if (key === "ocean") node = createNoise("brown");
  if (key === "wind") node = createNoise("white");
  if (key === "space") {
    node = audioCtx.createOscillator();
    node.type = "sine";
    node.frequency.value = 80;
  }

  const gain = audioCtx.createGain();
  gain.gain.value = 0.4;

  node.connect(gain).connect(masterGain);
  node.start();

  soundNodes[key] = { node, gain };
}

function stopSound(key) {
  if (!soundNodes[key]) return;
  try { soundNodes[key].node.stop(); } catch(e){}
  soundNodes[key] = null;
}

/* ---------------- SESSION CONTROL ---------------- */
let running = false;

startStopBtn.addEventListener("click", () => {
  if (!running) {
    running = true;
    startStopBtn.textContent = "Stop";

    if (!audioCtx) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      masterGain = audioCtx.createGain();
      masterGain.gain.value = 0.5;
      masterGain.connect(audioCtx.destination);
    }

    startBreathing();
    startTimer();

    document.querySelectorAll(".sound-btn.active").forEach(btn => {
      startSound(btn.dataset.sound);
    });

  } else {
    running = false;
    startStopBtn.textContent = "Start";

    stopBreathing();
    stopTimer();

    Object.keys(soundNodes).forEach(key => stopSound(key));
  }
});

/* ---------------- SOUND BUTTONS ---------------- */
document.querySelectorAll(".sound-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    btn.classList.toggle("active");

    if (running) {
      if (btn.classList.contains("active")) startSound(btn.dataset.sound);
      else stopSound(btn.dataset.sound);
    }
  });
});

/* ---------------- VOLUME ---------------- */
document.getElementById("volumeSlider").addEventListener("input", e => {
  if (masterGain) masterGain.gain.value = e.target.value;
});
</script>

</body>
</html>
